pipeline {
  agent any {
    stages {
      stage('Build'){
        steps('checkout git') {
          echo 'pulling project from git ...';
          git branch : 'khalil_romdhani',
          url 'https://github.com/romdhanikhalil16/achat'
        }
      }
      stage('Maven') {
            steps {
                echo 'building project ...';
                sh 'mvn clean install',
            }
        }

      stage('Test with Mockito and JUnit') {
            steps {
                echo 'Test project ...';
                // Install dependencies (assuming Maven)
                sh 'mvn dependency:copy-dependencies'

                // Test execution with JUnit
                sh 'junit -cp "${WORKSPACE}/target/classes;${WORKSPACE}/target/test-classes"  **com.example.tests**.**MyTestSuite'
            }
        }
      stage('SonarQube') {
            steps {
                echo 'Code Quality Testing (sonar) ...';
                withSonarQubeEnv(serverUrl: 'http://192.168.28.129:9000', credentialsId: 'sonar-credentials-id') {
                    sh 'mvn org.sonarsource.scanner.maven:sonar-maven-plugin:3.11.0.3922:sonar'
                }
            }
    }
  }
}
